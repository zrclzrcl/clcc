SET GLOBAL innodb_flush_log_at_trx_commit = 1;
SET GLOBAL tx_isolation = 'REPEATABLE READ';
CREATE TABLE t1 (id INT PRIMARY KEY, name VARCHAR(255)) ENGINE=InnoDB;
SHOW WARNINGS;
INSERT INTO t1 VALUES (1, "Alice"), (2, "Bob");
UPDATE t1 SET name = "Charlie" WHERE id = 1;
DELETE FROM t1 WHERE id = 2;
TRUNCATE TABLE t1;
RENAME TABLE t1 TO t11;
PREPARE stmt1 FROM "CREATE TABLE t2 (id INT PRIMARY KEY, data TEXT) ENGINE=MyISAM";
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
ALTER TABLE t2 ADD COLUMN created_at DATETIME DEFAULT CURRENT_TIMESTAMP;
CREATE TRIGGER tri_t1 AFTER UPDATE ON t11 FOR EACH ROW INSERT INTO t2 VALUES (NEW.id, NEW.name, NOW());
CREATE PROCEDURE proc_test() BEGIN INSERT INTO t11 VALUES (3, "Dave"); END;
LOCK TABLES t11 READ, t2 WRITE;
CALL proc_test();
UNLOCK TABLES;