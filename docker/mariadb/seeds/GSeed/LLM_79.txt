CREATE TABLE t1 (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE = 'InnoDB';

INSERT INTO t1 (name, created_at) VALUES ('Test1', NOW());
INSERT INTO t1 (name, created_at) VALUES ('Test2', '2023-01-01 00:00:00');

START TRANSACTION;
    UPDATE t1 SET name = 'UpdatedName' WHERE id = 1;
    SAVEPOINT sp1;
    DELETE FROM t1 WHERE id = 2;
    ROLLBACK TO sp1;
COMMIT;

PREPARE stmt1 FROM 'SELECT * FROM t1 WHERE id = ?';
SET @id = 1;
EXECUTE stmt1 USING @id;
DEALLOCATE PREPARE stmt1;

SET @query = 'EXPLAIN SELECT name FROM t1';
PREPAREstmt2 FROM @query;
EXECUTE stmt2;
DEALLOCATE PREPARE stmt2;

CREATE TABLE t2 (
    id INT PRIMARY KEY,
    value DECIMAL(10, 2) CHECK (value > 0)
) ENGINE = 'MyISAM';

INSERT INTO t2 VALUES (1, 100.50);

RENAME TABLE t1 TO t1_old;
RENAME TABLE t2 TO t2_new;

SET @arg00 = 'SELECT id FROM t1_old';
PREPARE stmt3 FROM @arg00;
EXECUTE stmt3;
DEALLOCATE PREPARE stmt3;

CREATE EVENT IF NOT EXISTS e1
    ON SCHEDULE EVERY 1 HOUR
    DO INSERT INTO t2 VALUES (2, 200.75);

ALTER TABLE t1_old ADD COLUMN active BOOLEAN DEFAULT TRUE;

START TRANSACTION WITH CONSISTENT SNAPSHOT;
    SELECT * FROM t1_old;
COMMIT;

SET GLOBAL sql_mode = 'STRICT_TRANS_TABLES';

CREATE TABLE t3 (
    id INT PRIMARY KEY,
    data TEXT
) ENGINE = 'MEMORY';

INSERT INTO t3 VALUES (1, 'Sample Data');

ANALYZE TABLE t1_old;

START TRANSACTION;
    INSERT INTO t2_new VALUES (3, 300.00);
    COMMIT;

PREPARE stmt4 FROM 'SELECT COUNT(*) AS total FROM t3';
EXECUTE stmt4;
DEALLOCATE PREPARE stmt4;

SET @arg00 = 'SELECT * FROM t1_old WHERE active = TRUE';
PREPAREstmt5 FROM @arg00;
EXECUTE stmt5;
DEALLOCATE PREPARE stmt5;

RENAME TABLE t1_old TO t1, t2_new TO t2;

DROP EVENT e1;

SET GLOBAL max_connections = 500;